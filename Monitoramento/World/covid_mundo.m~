%=======================================================================%
%                             COVID-19                                  %
%                      OBSERVATÓRIO FLUMINENSE                          %
%                           covid19rj.org                               %
%                                                                       %
%                  - COVID-19 NOS PAÍSES MAIS AFETADOS -                %
%                                                                       %
% Este algoritmo gera gráficos sobre os números de casos e mortes por   %
% Covid-19 nos países mais afetados.                                    %
%                                                                       %
% A série de gráficos contém:                                           %
% - número de casos por milhão em relação ao tempo desde 10 casos por   %
% milhão;                                                               %
% - número de mortes por milhão em relação ao tempo desde 1 morte por   %
% milhão;                                                               %
% - número de novos casos por semana em relação ao total de casos (por  %
% milhão de habitantes);                                                %
% - número de novas mortes por semana em relação ao total de mortes     %
% (por milhão de habitantes).                                           %
%                                                                       %
% Você precisará dos arquivos "global_cases.csv" e "global_deaths.csv"  %
% encontrados no repositório https://github.com/americocunhajr/COVID19RJ % 
% Esses arquivos são atualizados conforme os dados do                   % 
% https://www.worldometers.info/coronavirus/                            %
%                                                                       %
%                                                                       %
%                             Malú Grave                                %
%                         malugravemg@gmail.com                         %
%                        malugrave@nacad.ufjr.br                        %
%                                                                       %
%         [x] Working                                                   %
% Status: [ ] Not working                                               %
%         [ ] Experimental                                              %
%                                                                       %
% Last Update [07/05/2020]                                              %
%_______________________________________________________________________%
%=======================================================================%
clc;
clear all;
close all;

%nome que aparece nos arquivos
name = 'paises';

% Definindo o dia zero para casos e mortes (por milhão)
X_cases = 10;
X_deaths = 1;

%Lendo o arquivo disponível no site 
all_data = readtable('owid-covid-data.csv');


NP = 13; % número de países que serão extraídos da planilha

for( init = 1:1:2)

if (init == 1) country = 'Brazil' e;
if (init == 2) country = 'China';
    

data = table2array(all_data(:,4:end));

location = data(find(strcmp([all_data.location], country)),:);

dates = all_data.date(find(strcmp([all_data.location], country)),:);
dates = datenum(dates) - datenum(date);

tot_cases = location(:,1);
new_cases = location(:,2);
tot_deaths = location(:,3);
new_deaths = location(:,4);

tot_cases_pm = location(:,5);
new_cases_pm = location(:,6);
tot_deaths_pm = location(:,7);
new_deaths_pm = location(:,8);

%consolidando os novos casos e mortes por semana
new_cases7 = new_cases;
for (i=7:1:max(max(size(dates))) ) 
new_cases7(i,1) = new_cases(i,1)+new_cases(i-1,1)+new_cases(i-2,1)+new_cases(i-3,1)+new_cases(i-4,1)+new_cases(i-5,1)+new_cases(i-6,1);
new_deaths7(i,1) = new_deaths(i,1)+new_deaths(i-1,1)+new_deaths(i-2,1)+new_deaths(i-3,1)+new_deaths(i-4,1)+new_deaths(i-5,1)+new_deaths(i-6,1);
new_cases7_pm(i,1) = new_cases_pm(i,1)+new_cases_pm(i-1,1)+new_cases_pm(i-2,1)+new_cases_pm(i-3,1)+new_cases_pm(i-4,1)+new_cases_pm(i-5,1)+new_cases_pm(i-6,1);
new_deaths7_pm(i,1) = new_deaths_pm(i,1)+new_deaths_pm(i-1,1)+new_deaths_pm(i-2,1)+new_deaths_pm(i-3,1)+new_deaths_pm(i-4,1)+new_deaths_pm(i-5,1)+new_deaths_pm(i-6,1);
end

%Criando vetores desde dia zero a partir de X mortes/milhao ("_deaths") ou a partir de X casos/milhao ("_cases")
%Usuário define dia zero para casos ou mortes
X_deaths_pm = 1;
X_cases_pm = 10;
X_deaths = 100;
X_cases = 1000;

n=0;
for (i=1:1:max(max(size(dates))) )
if (tot_deaths(i,1) >= X_deaths)
n=n+1;
tot_deathsX(n,1) = tot_deaths(i,1);
new_deathsX(n,1) = new_deaths(i,1);
end
end
n=0;
for (i=1:1:max(max(size(dates))) )
if (tot_cases(i,1) >= X_cases)
n=n+1;
tot_casesX(n,1) = tot_cases(i,1);
new_cases(n,1) = new_cases(i,1);
end
end
n=0;
for (i=1:1:max(max(size(dates))) )
if (tot_cases_pm(i,1) >= X_cases_pm)
n=n+1;
tot_cases_pmX(n,1) = tot_cases_pm(i,1);
new_cases_pm(n,1) = new_cases_pm(i,1);
end
end
n=0;
for (i=1:1:max(max(size(dates))) )
if (tot_deaths_pm(i,1) >= X_deaths_pm)
n=n+1;
tot_deaths_pmX(n,1) = tot_deaths_pm(i,1);
new_deaths_pm(n,1) = new_deaths_pm(i,1);
end
end


%  
% % %Definindo valor maximo dos eixos, considerando todos os estados
% 
%Estilos e cores
%Fontes, estilos e cores
fonte_titulo = 9;
fonte_labels = 8;
fonte_padrao = 8; %numeros dos eixos
fonte_location = 7;
%  
% colorUS = [0,169,74]/255;
% colorFR = [0,99,181]/255;
% colorIT = [254,88,52]/255;
% colorSP = [209,227,105]/255;
% colorGE = [135,85,30]/255;
% colorBR = [0,0,0];
% 
% lineUS = '-';
% lineFR = '-';
% lineIT = '-';
% lineSP = '-';
% lineGE = '-';
% lineBR = '-';
%  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Plotar total de mortes/milhao por tempo (dia zero definido por mortes/milhao)
figure (1);
   
 n = max(max(size(tot_deaths_pmX)));
 days = 0:1:n-1;
 fig=semilogy(days,tot_deaths_pmX,'DisplayName',country);
 hold on;
 text (n-1, tot_deaths_pmX(n,1), [' ',country],'FontSize',fonte_location);%,"color",colorBR)

  
set(gca,'FontSize',fonte_padrao)
title({'Letalidade da epidemia',['Países mais afetados em ',date]},'FontSize',fonte_titulo);
xlabel(['Dias desde que se ultrapassou ',num2str(X_deaths),' morte (por milhão de habitantes)'],'FontSize',fonte_labels);
ylabel ("Total de mortes (por milhão de habitantes)",'FontSize',fonte_labels);
legend ("location", "northwest");
%axis([0 60 1 1000]);
Pos = [250,250,600,450];
set(0, 'DefaultFigurePosition', Pos);

% pra botar o logo no inferior direito
ha =gca;
uistack(ha,'bottom');
% Creating a new axes for the logo on the current axes
% To create the logo at the bottom left corner of the plot use 
% the next two lines
haPos = get(ha,'position');
ha2=axes('position',[haPos([3 1])-[.1 -0.0], .22,.12,]);
% To place the logo at the bottom left corner of the figure window
% uncomment the line below and comment the above two lines
%ha2=axes('position',[0, 0, .1,.04,]);
% Adding a LOGO to the new axes
% The logo file(jpeg, png, etc.) must be placed in the working path
[x, map]=imread('logo.png');
image(x)
% Setting the colormap to the colormap of the imported logo image
colormap (map)
% Turn the handlevisibility off so that we don't inadvertently plot
% into the axes again. Also, make the axes invisible
set(ha2,'handlevisibility','off','visible','off')

saveas(gcf,[name,'_letalidade_',datestr(date,29),'.png']);

end
% 
% 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% figure (2);
% [n1,n2] = size(BR_cases);
% n=n1;
% days_state = 0:1:n-1;
% figBR=semilogy(days_state,BR_cases(:,2),'DisplayName','Brazil')
% hold on;
% set(figBR,'LineWidth', 1,"color",colorBR,'Linestyle',lineBR)
% text (n-1, BR_cases(n,2), [' Brazil'],'FontSize',fonte_estados,"color",colorBR);
% 
% [n1,n2] = size(US_cases);
% n=n1;
% days_state = 0:1:n-1;
% figUS=semilogy(days_state,US_cases(:,2))
% hold on;
% set(figUS,'LineWidth', 1,"color",colorUS,'DisplayName','US','Linestyle',lineUS)
% text (n-1, US_cases(n1,2), [' US'],'FontSize',fonte_estados,"color",colorUS);
% 
% [n1,n2] = size(FR_cases);
% n=n1;
% days_state = 0:1:n-1;
% figFR=semilogy(days_state,FR_cases(:,2))
% hold on;
% set(figFR,'LineWidth', 1,"color",colorFR,'DisplayName','France','Linestyle',lineFR)
% text (n-1, FR_cases(n1,2), [' France'],'FontSize',fonte_estados,"color",colorFR);
% 
% [n1,n2] = size(IT_cases);
% n=n1;
% days_state = 0:1:n-1;
% figIT=semilogy(days_state,IT_cases(:,2))
% hold on;
% set(figIT,'LineWidth', 1,"color",colorIT,'DisplayName','Italy','Linestyle',lineIT)
% text (n-1, IT_cases(n1,2), [' Italy'],'FontSize',fonte_estados,"color",colorIT);
% 
% [n1,n2] = size(SP_cases);
% n=n1;
% days_state = 0:1:n-1;
% figSP=semilogy(days_state,SP_cases(:,2))
% hold on;
% set(figSP,'LineWidth', 1,"color",colorSP,'DisplayName','Spain','Linestyle',lineSP)
% text (n-1, SP_cases(n1,2), [' Spain'],'FontSize',fonte_estados,"color",colorSP);
% 
% [n1,n2] = size(GE_cases);
% n=n1;
% days_state = 0:1:n-1;
% figGE=semilogy(days_state,GE_cases(:,2))
% hold on;
% set(figGE,'LineWidth', 1,"color",colorGE,'DisplayName','Germany','Linestyle',lineGE)
% text (n-1, GE_cases(n1,2), [' Germany'],'FontSize',fonte_estados,"color",colorGE);
% 
% set(gca,'FontSize',fonte_padrao)
% title({'Contágio da epidemia',['Países mais afetados em ',end_time]},'FontSize',fonte_titulo);
% xlabel(['Dias desde que se ultrapassou ',num2str(X_cases),' morte (por milhão de habitantes)'],'FontSize',fonte_labels);
% ylabel ("Total de casos (por milhão de habitantes)",'FontSize',fonte_labels);
% legend ("location", "northwest");
% axis([0 axis_days_cases 10 axis_cases]);
% Pos = [250,250,600,450];
% set(0, 'DefaultFigurePosition', Pos);
% 
% % pra botar o logo no inferior direito
% ha =gca;
% uistack(ha,'bottom');
% % Creating a new axes for the logo on the current axes
% % To create the logo at the bottom left corner of the plot use 
% % the next two lines
% haPos = get(ha,'position');
% ha2=axes('position',[haPos([3 1])-[.1 -0.0], .22,.12,]);
% % To place the logo at the bottom left corner of the figure window
% % uncomment the line below and comment the above two lines
% %ha2=axes('position',[0, 0, .1,.04,]);
% % Adding a LOGO to the new axes
% % The logo file(jpeg, png, etc.) must be placed in the working path
% [x, map]=imread('logo.png');
% image(x)
% % Setting the colormap to the colormap of the imported logo image
% colormap (map)
% % Turn the handlevisibility off so that we don't inadvertently plot
% % into the axes again. Also, make the axes invisible
% set(ha2,'handlevisibility','off','visible','off')
% 
% saveas(gcf,[name,'_contagio_',datestr(end_time,29),'.png']);
% 
% 
% close(figure(2));
% 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %Plotar novas mortes X total de mortes (por milhao de hab.)
% figure (3);
% 
% figBR=loglog(BR_per_million_week(:,4),BR_per_million_week(:,3),'DisplayName','Brazil')
% hold on;
% set(figBR,'LineWidth', 1,"color",colorBR,'Linestyle',lineBR)
% text (BR_per_million_week(D,4), BR_per_million_week(D,3), [' Brazil'],'FontSize',fonte_estados,"color",colorBR);
% 
% figUS=loglog(US_per_million_week(:,4),US_per_million_week(:,3),'DisplayName','US')
% hold on;
% set(figUS,'LineWidth', 1,"color",colorUS,'Linestyle',lineUS)
% text (US_per_million_week(D,4), US_per_million_week(D,3), [' US'],'FontSize',fonte_estados,"color",colorUS);
% 
% figFR=loglog(FR_per_million_week(:,4),FR_per_million_week(:,3),'DisplayName','France')
% hold on;
% set(figFR,'LineWidth', 1,"color",colorFR,'Linestyle',lineFR)
% text (FR_per_million_week(D,4), FR_per_million_week(D,3), [' France'],'FontSize',fonte_estados,"color",colorFR);
% 
% figIT=loglog(IT_per_million_week(:,4),IT_per_million_week(:,3),'DisplayName','Italy')
% hold on;
% set(figIT,'LineWidth', 1,"color",colorIT,'Linestyle',lineIT)
% text (IT_per_million_week(D,4), IT_per_million_week(D,3), [' Italy'],'FontSize',fonte_estados,"color",colorIT);
% 
% figSP=loglog(SP_per_million_week(:,4),SP_per_million_week(:,3),'DisplayName','Spain')
% hold on;
% set(figSP,'LineWidth', 1,"color",colorSP,'Linestyle',lineSP)
% text (SP_per_million_week(D,4), SP_per_million_week(D,3), [' Spain'],'FontSize',fonte_estados,"color",colorSP);
% 
% figGE=loglog(GE_per_million_week(:,4),GE_per_million_week(:,3),'DisplayName','Germany')
% hold on;
% set(figGE,'LineWidth', 1,"color",colorGE,'Linestyle',lineGE)
% text (GE_per_million_week(D,4), GE_per_million_week(D,3), [' Germany'],'FontSize',fonte_estados,"color",colorGE);
% 
% 
% set(gca,'FontSize',fonte_padrao);
% title({'Informativo de progresso da epidemia (número de mortes)',['Países mais afetados em ',end_time]},'FontSize',fonte_titulo)
% ylabel(['Novas mortes por semana (por milhão de habitantes)'],'FontSize',fonte_labels);
% xlabel ("Total de mortes (por milhão de habitantes)",'FontSize',fonte_labels);
% legend ("location", "northwest");
% axis([1 axis_deaths 1 axis_new_deaths]);
% Pos = [250,250,600,450];
% set(0, 'DefaultFigurePosition', Pos);
% 
% % pra botar o logo no inferior direito
% ha =gca;
% uistack(ha,'bottom');
% % Creating a new axes for the logo on the current axes
% % To create the logo at the bottom left corner of the plot use 
% % the next two lines
% haPos = get(ha,'position');
% ha2=axes('position',[haPos([3 1])-[.1 -0.0], .22,.12,]);
% % To place the logo at the bottom left corner of the figure window
% % uncomment the line below and comment the above two lines
% %ha2=axes('position',[0, 0, .1,.04,]);
% % Adding a LOGO to the new axes
% % The logo file(jpeg, png, etc.) must be placed in the working path
% [x, map]=imread('logo.png');
% image(x)
% % Setting the colormap to the colormap of the imported logo image
% colormap (map)
% % Turn the handlevisibility off so that we don't inadvertently plot
% % into the axes again. Also, make the axes invisible
% set(ha2,'handlevisibility','off','visible','off')
% 
% saveas(gcf,[name,'_informativo-mortes_',datestr(end_time,29),'.png']);
% 
% 
% close(figure(3));
% 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %Plotar novos casos X total de casos (por milhao de hab.)
% figure (4);
% 
% 
% figBR=loglog(BR_per_million_week(:,2),BR_per_million_week(:,1),'DisplayName','Brazil')
% hold on;
% set(figBR,'LineWidth', 1,"color",colorBR,'Linestyle',lineBR)
% text (BR_per_million_week(D,2), BR_per_million_week(D,1), [' Brazil'],'FontSize',fonte_estados,"color",colorBR);
% 
% figUS=loglog(US_per_million_week(:,2),US_per_million_week(:,1),'DisplayName','US')
% hold on;
% set(figUS,'LineWidth', 1,"color",colorUS,'Linestyle',lineUS)
% text (US_per_million_week(D,2), US_per_million_week(D,1), [' US'],'FontSize',fonte_estados,"color",colorUS);
% 
% figFR=loglog(FR_per_million_week(:,2),FR_per_million_week(:,1),'DisplayName','France')
% hold on;
% set(figFR,'LineWidth', 1,"color",colorFR,'Linestyle',lineFR)
% text (FR_per_million_week(D,2), FR_per_million_week(D,1), [' France'],'FontSize',fonte_estados,"color",colorFR);
% 
% figIT=loglog(IT_per_million_week(:,2),IT_per_million_week(:,1),'DisplayName','Italy')
% hold on;
% set(figIT,'LineWidth', 1,"color",colorIT,'Linestyle',lineIT)
% text (IT_per_million_week(D,2), IT_per_million_week(D,1), [' Italy'],'FontSize',fonte_estados,"color",colorIT);
% 
% figSP=loglog(SP_per_million_week(:,2),SP_per_million_week(:,1),'DisplayName','Spain')
% hold on;
% set(figSP,'LineWidth', 1,"color",colorSP,'Linestyle',lineSP)
% text (SP_per_million_week(D,2), SP_per_million_week(D,1), [' Spain'],'FontSize',fonte_estados,"color",colorSP);
% 
% figGE=loglog(GE_per_million_week(:,2),GE_per_million_week(:,1),'DisplayName','Germany')
% hold on;
% set(figGE,'LineWidth', 1,"color",colorGE,'Linestyle',lineGE)
% text (GE_per_million_week(D,2), GE_per_million_week(D,1), [' Germany'],'FontSize',fonte_estados,"color",colorGE);
% 
% 
% set(gca,'FontSize',fonte_padrao);
% title({'Informativo de progresso da epidemia (número de casos)',['Países mais afetados em ',end_time]},'FontSize',fonte_titulo);
% ylabel(['Novos casos por semana (por milhão de habitantes)'],'FontSize',fonte_labels);
% xlabel ("Total de casos (por milhão de habitantes)",'FontSize',fonte_labels);
% legend ("location", "northwest");
% axis([10 axis_cases 10 axis_new_cases]);
% Pos = [250,250,600,450];
% set(0, 'DefaultFigurePosition', Pos);
% 
% % pra botar o logo no inferior direito
% ha =gca;
% uistack(ha,'bottom');
% % Creating a new axes for the logo on the current axes
% % To create the logo at the bottom left corner of the plot use 
% % the next two lines
% haPos = get(ha,'position');
% ha2=axes('position',[haPos([3 1])-[.1 -0.0], .22,.12,]);
% % To place the logo at the bottom left corner of the figure window
% % uncomment the line below and comment the above two lines
% %ha2=axes('position',[0, 0, .1,.04,]);
% % Adding a LOGO to the new axes
% % The logo file(jpeg, png, etc.) must be placed in the working path
% [x, map]=imread('logo.png');
% image(x)
% % Setting the colormap to the colormap of the imported logo image
% colormap (map)
% % Turn the handlevisibility off so that we don't inadvertently plot
% % into the axes again. Also, make the axes invisible
% set(ha2,'handlevisibility','off','visible','off')
% 
% saveas(gcf,[name,'_informativo-casos_',datestr(end_time,29),'.png']);
% 
% 
% close(figure(4));
% 
%     
%     
%         
